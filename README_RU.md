<sup>[ [en](https://github.com/yozhic/goldendict-macos-builds) | ru ]</sup>  

# goldendict-macos-builds

Неофициальные сборки программы GoldenDict для macOS

Собрано на базе Qt 5.14.2 и 5.15.2 (Clang 11.0, x86_64) и QtWebKit 5.212.0 Alpha 4  
Работоспособность протестирована на Mojave, Big Sur, Monterey, Ventura, Sonoma  

> [!IMPORTANT]  
> Настоящие сборки предоставляются как есть, без каких-либо гарантий.  

## Описание

Сборки предоставляются в двух версиях: `master` и `mac-adapted`.  

Версия `master` собирается из исходного кода [официального репозитория GoldenDict](https://github.com/goldendict/goldendict) без изменений и дополнений, как есть.  

Версия `mac-adapted` собирается на основе исходного кода официального репозитория GoldenDict, с внесением косметических изменений и дополнений для лучшей адаптации к внешнему виду macOS. С историей изменений можно ознакомиться в [ответвлении кода GoldenDict](https://github.com/yozhic/goldendict/tree/mac-adapted), где они производятся. Вкратце, они включают: новые иконки для панелей инструментов, дополнительные стили для окон программы и словарных статей.  

Визуальные отличия между двумя версиями проиллюстрированы ниже.  

## Настройки

### В системе

Для работоспособности таких функций, как Всплывающее окно и Глобальные горячие клавиши, необходимо предоставить GoldenDict разрешение на управление Mac через функции универсального доступа. Для этого:  

- открываем меню Apple  → Системные настройки → Защита и безопасность → вкладка Конфиденциальность;
- разблокируем возможность редактирования щелчком по иконке замочка :lock: внизу окна;
- в левой панели выбираем Универсальный доступ, в правой жмём кнопку Добавить :heavy_plus_sign:, находим и выделяем `GoldenDict.app`, жмём Открыть;  
  можно также перетащить `app` из окна Finder на панель списка приложений;
- отмечаем флажок :ballot_box_with_check: слева от `GoldenDict.app`[^1].  

[^1]: Источник: [Apple Support: Разрешение доступа к компьютеру Mac программам Универсального доступа](https://support.apple.com/ru-ru/guide/mac-help/mh43185/10.14/mac/10.14)  

> [!IMPORTANT]
> В силу особенностей работы macOS, процедуру предоставления разрешений необходимо повторять после каждого обновления GoldenDict. Для этого:
> - в указанном диалоге выделяем строку `GoldenDict.app` и жмём кнопку Удалить :heavy_minus_sign:;
> - затем жмём кнопку Добавить :heavy_plus_sign: и далее, как описано выше.  

### В программе

Дополнительные стили сборки `mac-adapted` включаются в настройках GoldenDict → вкладка Интерфейс → выпадающий список Стиль интерфейса. Стили синхронизированы с системными настройками оформления macOS, т.е. при включенном системном оформлении `Light` следует использовать стиль `macOS Light`, а при системном `Dark` — один из двух тёмных стилей, `macOS Dark` или `macOS Dark Deep`.  

## Известные проблемы

<dl>
  <dt>Не работает ⌘+C</dt>
    <dd>Если при включенном GoldenDict в других приложениях перестаёт работать копирование текста по сочетанию клавиш <kbd>Cmd+C</kbd>, необходимо предоставить GoldenDict разрешение на Универсальный доступ. Описание данной процедуры см. выше. Это помогает в большинстве случаев. Если же и после этого <kbd>Cmd+C</kbd> по прежнему не работает в каком-либо приложении (на сегодня в этом замечен только Vivaldi), единственный выход — удалить сочетание <kbd>⌘C+C</kbd> в настройках GoldenDict → Горячие клавиши, и назначить другое сочетание, например <kbd>⌥⌘C</kbd>.</dd>
  <dt>Плохо работает Всплывающее окно</dt>
    <dd>К сожалению, функция Всплывающее окно на последних версиях macOS действительно не работает так же хорошо, как на Windows. Для исправления требуется участие опытного программиста. А в настоящий момент мы рекомендуем воздержаться от её использования на macOS и полностью отключить её в настройках.</dd>
  <dt>Не работает trackClipboardChanges</dt>
    <dd>Действительно, на последних версиях macOS эта функция, к сожалению, неработоспособна. Для исправления требуется участие опытного программиста.</dd>
</dl>

## Отличия

Сравнение версий: окно программы, системное оформление `Light`, стиль `macOS Light`  

![COMPARE LIGHT](https://github.com/yozhic/goldendict-macos-builds/blob/main/screenshots/COMPARE_LIGHT.png)  

Сравнение версий: окно программы, системное оформление `Dark`, стиль `macOS Dark`  

![COMPARE DARK](https://github.com/yozhic/goldendict-macos-builds/blob/main/screenshots/COMPARE_DARK.png)  

Сравнение версий: окно программы, системное оформление `Dark`, стиль `macOS Dark Deep`  

![COMPARE DARK DEEP](https://github.com/yozhic/goldendict-macos-builds/blob/main/screenshots/COMPARE_DARK_DEEP.png)  

Сравнение версий: диалог настроек, системное оформление `Light`, стиль `macOS Light`  

![COMPARE PREFS](https://github.com/yozhic/goldendict-macos-builds/blob/main/screenshots/COMPARE_PREFS.png)  

## Скачать

Готовые к использованию сборки, упакованные в контейнер `dmg`, размещаются в разделе [Releases](https://github.com/yozhic/goldendict-macos-builds/releases).  

## Самостоятельная сборка

Для возможности сборки в системе должен быть установлен [Xcode](https://developer.apple.com/support/xcode). Далее:  

1. Скачиваем установщик Qt. Последний в свободном доступе: [5.14.2](https://download.qt.io/archive/qt/5.14/5.14.2/).  

2. Устанавливаем Qt. В процессе понадобится подключиться к личному кабинету Qt (если не существует, создаём). Путь для установки, например: `~/Qt`. В окне выбора компонентов отмечаем `Qt 5.14.2` → `macOS` (`Developer` отмечен по умолчанию).  

3. Скачиваем QtWebKit 5.212.0 Alpha 4, скомпилированный для macOS: [qtwebkit-MacOS-MacOS_10_13-Clang-MacOS-MacOS_10_13-X86_64.7z](https://github.com/qtwebkit/qtwebkit/releases). Распаковываем архив, копируем всю структуру папок в `~/Qt/5.14.2/clang_64`.  

4. Клонируем головной репозиторий `goldendict`:  

   ```sh
   git clone https://github.com/goldendict/goldendict && cd ./goldendict
   ```
   
5. Создаём проект:  

   ```sh
   ~/Qt/5.14.2/clang_64/bin/qmake
   ```

   Собираем:  

   ```sh
   make
   ```

6. Укомплектовываем собранный `GoldenDict.app` необходимыми библиотеками:  

   ```sh
   ~/Qt/5.14.2/clang_64/bin/macdeployqt GoldenDict.app
   ```

   Можно также сразу создать простой `dmg`:  
   
   ```sh
   ~/Qt/5.14.2/clang_64/bin/macdeployqt GoldenDict.app -dmg
   ```
